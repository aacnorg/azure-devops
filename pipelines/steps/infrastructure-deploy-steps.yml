parameters:
- name: armPath
  type: string 
  default: "."

steps:
  - task: AzureResourceManagerTemplateDeployment@3
    displayName: "Validate $(cogName)"
    inputs:
        deploymentScope: "Resource Group"
        azureResourceManagerConnection: "$(subscriptionName)"
        subscriptionId: "$(subscriptionId)"
        action: "Create Or Update Resource Group"
        resourceGroupName: "$(rgName)"
        location: "$(rgLocation)"
        templateLocation: "Linked artifact"
        csmFile: "${{ parameters.armPath }}/cog-cognitiveservices.json"        
        csmParametersFile: "${{ parameters.armPath }}/cog-cognitiveservices.parameters.json"        
        deploymentMode: "Validation"
        overrideParameters: -name "$(cogName)"

  - task: AzureResourceManagerTemplateDeployment@3
    displayName: "Deploy $(cogName)"
    inputs:
        deploymentScope: "Resource Group"
        azureResourceManagerConnection: "$(subscriptionName)"
        subscriptionId: "$(subscriptionId)"
        action: "Create Or Update Resource Group"
        resourceGroupName: "$(rgName)"
        location: "$(rgLocation)"
        templateLocation: "Linked artifact"
        csmFile: "${{ parameters.armPath }}/cog-cognitiveservices.json"
        csmParametersFile: "${{ parameters.armPath }}/cog-cognitiveservices.parameters.json"
        deploymentMode: "Incremental"
        overrideParameters: -name "$(cogName)"

  - task: AzureResourceManagerTemplateDeployment@3
    displayName: "Validate $(cogtextName)"
    inputs:
        deploymentScope: "Resource Group"
        azureResourceManagerConnection: "$(subscriptionName)"
        subscriptionId: "$(subscriptionId)"
        action: "Create Or Update Resource Group"
        resourceGroupName: "$(rgName)"
        location: "$(rgLocation)"
        templateLocation: "Linked artifact"
        csmFile: "${{ parameters.armPath }}/cogtext-textanalytics.json"        
        csmParametersFile: "${{ parameters.armPath }}/cogtext-textanalytics.parameters.json"        
        deploymentMode: "Validation"
        overrideParameters: -name "$(cogtextName)" -sku "$(cogtextSku)"

  - task: AzureResourceManagerTemplateDeployment@3
    displayName: "Deploy $(cogtextName)"
    inputs:
        deploymentScope: "Resource Group"
        azureResourceManagerConnection: "$(subscriptionName)"
        subscriptionId: "$(subscriptionId)"
        action: "Create Or Update Resource Group"
        resourceGroupName: "$(rgName)"
        location: "$(rgLocation)"
        templateLocation: "Linked artifact"
        csmFile: "${{ parameters.armPath }}/cogtext-textanalytics.json"
        csmParametersFile: "${{ parameters.armPath }}/cogtext-textanalytics.parameters.json"
        deploymentMode: "Incremental"
        overrideParameters: -name "$(cogtextName)" -sku "$(cogtextSku)"

  - task: AzureResourceManagerTemplateDeployment@3
    displayName: "Validate $(spocnName)"
    inputs:
        deploymentScope: "Resource Group"
        azureResourceManagerConnection: "$(subscriptionName)"
        subscriptionId: "$(subscriptionId)"
        action: "Create Or Update Resource Group"
        resourceGroupName: "$(rgName)"
        location: "$(rgLocation)"
        templateLocation: "Linked artifact"
        csmFile: "${{ parameters.armPath }}/spocn-sharepointonlineapiconnection.json"
        csmParametersFile: "${{ parameters.armPath }}/spocn-sharepointonlineapiconnection.parameters.json"
        deploymentMode: "Validation"
        overrideParameters: -name "$(spocnName)"

  - task: AzureResourceManagerTemplateDeployment@3
    displayName: "Deploy $(spocnName)"
    inputs:
        deploymentScope: "Resource Group"
        azureResourceManagerConnection: "$(subscriptionName)"
        subscriptionId: "$(subscriptionId)"
        action: "Create Or Update Resource Group"
        resourceGroupName: "$(rgName)"
        location: "$(rgLocation)"
        templateLocation: "Linked artifact"
        csmFile: "${{ parameters.armPath }}/spocn-sharepointonlineapiconnection.json"
        csmParametersFile: "${{ parameters.armPath }}/spocn-sharepointonlineapiconnection.parameters.json"
        deploymentMode: "Incremental"
        overrideParameters: -name "$(spocnName)"

  - task: AzureResourceManagerTemplateDeployment@3
    displayName: "Validate $(stblobcnName)"
    inputs:
        deploymentScope: "Resource Group"
        azureResourceManagerConnection: "$(subscriptionName)"
        subscriptionId: "$(subscriptionId)"
        action: "Create Or Update Resource Group"
        resourceGroupName: "$(rgName)"
        location: "$(rgLocation)"
        templateLocation: "Linked artifact"
        csmFile: "${{ parameters.armPath }}/stblobcn-storageblobapiconnection.json"
        csmParametersFile: "${{ parameters.armPath }}/stblobcn-storageblobapiconnection.parameters.json"
        deploymentMode: "Validation"
        overrideParameters: -name "$(stblobcnName)" -storageName "$(stName)" -storageKey "$(stKey)"

  - task: AzureResourceManagerTemplateDeployment@3
    displayName: "Deploy $(stblobcnName)"
    inputs:
        deploymentScope: "Resource Group"
        azureResourceManagerConnection: "$(subscriptionName)"
        subscriptionId: "$(subscriptionId)"
        action: "Create Or Update Resource Group"
        resourceGroupName: "$(rgName)"
        location: "$(rgLocation)"
        templateLocation: "Linked artifact"
        csmFile: "${{ parameters.armPath }}/stblobcn-storageblobapiconnection.json"
        csmParametersFile: "${{ parameters.armPath }}/stblobcn-storageblobapiconnection.parameters.json"
        deploymentMode: "Incremental"
        overrideParameters: -name "$(stblobcnName)" -storageName "$(stName)" -storageKey "$(stKey)"

  - task: AzureResourceManagerTemplateDeployment@3
    displayName: "Validate $(teamscnName)"
    inputs:
        deploymentScope: "Resource Group"
        azureResourceManagerConnection: "$(subscriptionName)"
        subscriptionId: "$(subscriptionId)"
        action: "Create Or Update Resource Group"
        resourceGroupName: "$(rgName)"
        location: "$(rgLocation)"
        templateLocation: "Linked artifact"
        csmFile: "${{ parameters.armPath }}/teamscn-teamsapiconnection.json"
        csmParametersFile: "${{ parameters.armPath }}/teamscn-teamsapiconnection.parameters.json"
        deploymentMode: "Validation"
        overrideParameters: -name "$(teamscnName)"

  - task: AzureResourceManagerTemplateDeployment@3
    displayName: "Deploy $(teamscnName)"
    inputs:
        deploymentScope: "Resource Group"
        azureResourceManagerConnection: "$(subscriptionName)"
        subscriptionId: "$(subscriptionId)"
        action: "Create Or Update Resource Group"
        resourceGroupName: "$(rgName)"
        location: "$(rgLocation)"
        templateLocation: "Linked artifact"
        csmFile: "${{ parameters.armPath }}/teamscn-teamsapiconnection.json"
        csmParametersFile: "${{ parameters.armPath }}/teamscn-teamsapiconnection.parameters.json"
        deploymentMode: "Incremental"
        overrideParameters: -name "$(teamscnName)"

  - task: AzureResourceManagerTemplateDeployment@3
    displayName: "Validate $(funcName)"
    inputs:
        deploymentScope: "Resource Group"
        azureResourceManagerConnection: "$(subscriptionName)"
        subscriptionId: "$(subscriptionId)"
        action: "Create Or Update Resource Group"
        resourceGroupName: "$(rgName)"
        location: "$(rgLocation)"
        templateLocation: "Linked artifact"
        csmFile: "${{ parameters.armPath }}/func-functionsapp.json"        
        csmParametersFile: "${{ parameters.armPath }}/func-functionsapp.parameters.json"        
        deploymentMode: "Validation"
        overrideParameters: -name "$(funcName)" -workspaceName "$(workName)" -storageName "$(stName)" -appInsightsKey "$(appiKey)" -appInsightsConnection "$(appiConnection)" -workerRuntime "dotnet-isolated" -environment "$(rgEnvironment)"

  - task: AzureResourceManagerTemplateDeployment@3
    displayName: "Deploy $(funcName)"
    inputs:
        deploymentScope: "Resource Group"
        azureResourceManagerConnection: "$(subscriptionName)"
        subscriptionId: "$(subscriptionId)"
        action: "Create Or Update Resource Group"
        resourceGroupName: "$(rgName)"
        location: "$(rgLocation)"
        templateLocation: "Linked artifact"
        csmFile: "${{ parameters.armPath }}/func-functionsapp.json"
        csmParametersFile: "${{ parameters.armPath }}/func-functionsapp.parameters.json"
        deploymentMode: "Incremental"
        overrideParameters: -name "$(funcName)" -workspaceName "$(workName)" -storageName "$(stName)" -appInsightsKey "$(appiKey)" -appInsightsConnection "$(appiConnection)" -workerRuntime "dotnet-isolated" -environment "$(rgEnvironment)"
